"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7270],{56224:function(e,a,t){t.d(a,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(62898).Z)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]])},97542:function(e,a,t){t.d(a,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(62898).Z)("FileSpreadsheet",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M14 17h2",key:"10kma7"}]])},76637:function(e,a,t){t.d(a,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(62898).Z)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]])},29764:function(e,a,t){t.d(a,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(62898).Z)("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]])},57270:function(e,a,t){t.r(a),t.d(a,{ShareExportMenu:function(){return k}});var r=t(57437),n=t(2265),i=t(85754),o=t(93930),l=t(83523),c=t(62442),s=t(56224),d=t(29764),m=t(76637),u=t(97542),p=t(25703),f=t(1657),h=t(63572),g=t(82302);let y="http://127.0.0.1:8000";async function x(e){try{let a=await fetch(e),t=await a.blob();return new Promise((e,a)=>{let r=new FileReader;r.onloadend=()=>{let a=r.result;e(a)},r.onerror=a,r.readAsDataURL(t)})}catch(e){throw console.error("Error converting image to base64:",e),e}}async function w(e,a){if(!e)return{original:null,processed:null};try{null==a||a("Loading car image...");let t=await x(e);null==a||a("Removing background... this may take a moment");let r=t.split(",")[1],n=atob(r),i=new Uint8Array(n.length);for(let e=0;e<n.length;e++)i[e]=n.charCodeAt(e);let o=new Blob([i],{type:"image/jpeg"}),l=await (0,g.X)(o,{model:"isnet_fp16",output:{format:"image/png"}}),c=await new Promise((e,a)=>{let t=new FileReader;t.onloadend=()=>{e(t.result)},t.onerror=a,t.readAsDataURL(l)});return null==a||a("Background removed! Generating PDF..."),{original:t,processed:c}}catch(a){console.warn("⚠️ Background removal failed, using original image:",a);try{return{original:await x(e),processed:null}}catch(e){return console.error("❌ Failed to load original image:",e),{original:null,processed:null}}}}async function _(){try{for(let e of["/behind_background.jpg","/behind_background.jpeg","/images/behind_background.jpg","/images/behind_background.jpeg"])try{return await x(e)}catch(e){continue}try{return await x("".concat(y,"/static/behind_background.jpg"))}catch(e){return console.warn("⚠️ Background image not found, PDF will use default background"),null}}catch(e){return console.warn("⚠️ Could not load background image:",e),null}}async function b(e,a,t){try{null==t||t("Preparing PDF generation...");let r=e.preview_image?e.preview_image:e.car_image_path?e.car_image_path.startsWith("http")?e.car_image_path:"".concat(y,"/api/car-images/").concat(e.car_image_path):e.similar_cars&&e.similar_cars.length>0&&e.similar_cars[0].image_url?e.similar_cars[0].image_url:null,n=null,i=null;if(r){let e=await w(r,t);n=e.processed,i=e.original}null==t||t("Loading background image...");let o=await _(),l={predicted_price:e.predicted_price,confidence_interval:e.confidence_interval,confidence_range:e.confidence_range,confidence_level:e.confidence_level,market_comparison:e.market_comparison,deal_score:e.deal_score,deal_analysis:e.deal_analysis,similar_cars:e.similar_cars,car_image_path:e.car_image_path,preview_image:e.preview_image,processed_car_image:n,original_car_image:i,background_image:o},c={year:a.year,make:a.make,model:a.model,trim:a.trim,mileage:a.mileage,condition:a.condition,location:a.location,fuel_type:a.fuel_type,engine_size:a.engine_size,cylinders:a.cylinders};null==t||t("Generating PDF certificate...");let s=await fetch("".concat(y,"/api/export/pdf"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prediction_result:l,car_features:c})});if(!s.ok){let e=await s.text();throw Error("PDF generation failed: ".concat(s.status," ").concat(e))}let d=await s.blob(),m=window.URL.createObjectURL(d),u=document.createElement("a");u.href=m;let p=a.make||"Car",f=a.model||"Model",h=Date.now();u.download="CarWiseIQ-Valuation-".concat(p,"-").concat(f,"-").concat(h,".pdf"),document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(m),null==t||t("PDF downloaded successfully!")}catch(e){throw console.error("❌ Error generating PDF:",e),e}}function k(e){let{result:a,carFeatures:t,showPdfExport:g=!0}=e,{toast:y}=(0,p.useToast)(),[x,w]=(0,n.useState)(!1),[_,k]=(0,n.useState)(!1),[v,j]=(0,n.useState)(""),N=()=>{let e="".concat(t.year," ").concat(t.make," ").concat(t.model),r=(0,f.xG)(a.predicted_price);return"\uD83D\uDE97 Car Price Prediction: ".concat(e,"\n\uD83D\uDCB0 Estimated Value: ").concat(r,"\n\nPredicted using CarWiseIQ")},C=()=>{let e=new URLSearchParams({make:t.make,model:t.model,year:t.year.toString(),mileage:t.mileage.toString(),condition:t.condition,price:a.predicted_price.toString()});return"".concat(window.location.origin,"/predict?").concat(e.toString())},E=async()=>{try{let e=N();await navigator.clipboard.writeText(e),w(!0),y({title:"Copied!",description:"Prediction details copied to clipboard"}),setTimeout(()=>w(!1),2e3)}catch(e){y({title:"Error",description:"Failed to copy to clipboard",variant:"destructive"})}},F=async()=>{let e={title:"Car Price Prediction",text:N(),url:C()};if(navigator.share)try{await navigator.share(e)}catch(e){}else E()},P=async()=>{try{var e,r,n,i;let o=[{Make:t.make,Model:t.model,Year:t.year,"Mileage (km)":t.mileage,Condition:t.condition,"Fuel Type":t.fuel_type,Location:t.location,"Predicted Price":a.predicted_price,"Lower CI":(null===(e=a.confidence_interval)||void 0===e?void 0:e.lower)||"","Upper CI":(null===(r=a.confidence_interval)||void 0===r?void 0:r.upper)||"","Market Average":(null===(n=a.market_comparison)||void 0===n?void 0:n.market_average)||"","Deal Score":(null===(i=a.deal_score)||void 0===i?void 0:i.label)||""}],l=await h.apiClient.exportExcel(o);h.apiClient.downloadBlob(l,"car-prediction-".concat(t.make,"-").concat(t.model,"-").concat(Date.now(),".xlsx")),y({title:"Success",description:"Excel file downloaded successfully"})}catch(e){y({title:"Error",description:"Failed to export Excel file",variant:"destructive"})}},D=async()=>{k(!0),j("Initializing...");try{await b(a,t,e=>{j(e)}),y({title:"Success",description:"Valuation certificate downloaded successfully"})}catch(e){console.error("PDF export error:",e),y({title:"Error",description:e instanceof Error?e.message:"Failed to export PDF file",variant:"destructive"})}finally{k(!1),j("")}};return(0,r.jsxs)(o.h_,{children:[(0,r.jsx)(o.$F,{asChild:!0,children:(0,r.jsxs)(i.z,{variant:"outline",size:"sm",className:"w-full sm:w-auto border-[#2a2d3a] bg-transparent hover:bg-[#2a2d3a] text-white hover:text-white",children:["Share / Export",(0,r.jsx)(l.Z,{className:"ml-2 h-4 w-4"})]})}),(0,r.jsxs)(o.AW,{align:"end",className:"w-48",children:[(0,r.jsx)(o.Xi,{onClick:E,children:x?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.Z,{className:"mr-2 h-4 w-4"}),"Copied!"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.Z,{className:"mr-2 h-4 w-4"}),"Copy Results"]})}),"undefined"!=typeof navigator&&"share"in navigator&&"function"==typeof navigator.share&&(0,r.jsxs)(o.Xi,{onClick:F,children:[(0,r.jsx)(d.Z,{className:"mr-2 h-4 w-4"}),"Share"]}),(0,r.jsx)(o.VD,{}),g&&(0,r.jsxs)(o.Xi,{onClick:D,disabled:_,children:[(0,r.jsx)(m.Z,{className:"mr-2 h-4 w-4"}),_?(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"animate-spin mr-2",children:"⏳"}),v||"Processing Image..."]}):"Export PDF"]}),(0,r.jsxs)(o.Xi,{onClick:P,children:[(0,r.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"Export Excel"]})]})]})}},93930:function(e,a,t){t.d(a,{$F:function(){return m},AW:function(){return u},VD:function(){return f},Xi:function(){return p},h_:function(){return d}});var r=t(57437),n=t(2265),i=t(20949),o=t(17158),l=t(62442),c=t(76369),s=t(1657);let d=i.fC,m=i.xz;i.ZA,i.Uv,i.Tr,i.Ee,n.forwardRef((e,a)=>{let{className:t,inset:n,children:l,...c}=e;return(0,r.jsxs)(i.fF,{ref:a,className:(0,s.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",n&&"pl-8",t),...c,children:[l,(0,r.jsx)(o.Z,{className:"ml-auto h-4 w-4 rtl:rotate-180"})]})}).displayName=i.fF.displayName,n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(i.tu,{ref:a,className:(0,s.cn)("z-[1000] min-w-[8rem] max-h-[60vh] overflow-y-auto overscroll-contain rounded-md border border-[#2a2d3a] bg-[#1a1d29] p-1 text-white shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})}).displayName=i.tu.displayName;let u=n.forwardRef((e,a)=>{let{className:t,sideOffset:n=4,...o}=e;return(0,r.jsx)(i.Uv,{children:(0,r.jsx)(i.VY,{ref:a,sideOffset:n,className:(0,s.cn)("z-[1000] min-w-[8rem] max-h-[60vh] overflow-y-auto overscroll-contain rounded-md border border-[#2a2d3a] bg-[#1a1d29] p-1 text-white shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...o})})});u.displayName=i.VY.displayName;let p=n.forwardRef((e,a)=>{let{className:t,inset:n,...o}=e;return(0,r.jsx)(i.ck,{ref:a,className:(0,s.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-[#2a2d3a] focus:text-white data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n&&"pl-8",t),...o})});p.displayName=i.ck.displayName,n.forwardRef((e,a)=>{let{className:t,children:n,checked:o,...c}=e;return(0,r.jsxs)(i.oC,{ref:a,className:(0,s.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-[#2a2d3a] focus:text-white data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:o,...c,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(i.wU,{children:(0,r.jsx)(l.Z,{className:"h-4 w-4"})})}),n]})}).displayName=i.oC.displayName,n.forwardRef((e,a)=>{let{className:t,children:n,...o}=e;return(0,r.jsxs)(i.Rk,{ref:a,className:(0,s.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-[#2a2d3a] focus:text-white data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...o,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(i.wU,{children:(0,r.jsx)(c.Z,{className:"h-2 w-2 fill-current"})})}),n]})}).displayName=i.Rk.displayName,n.forwardRef((e,a)=>{let{className:t,inset:n,...o}=e;return(0,r.jsx)(i.__,{ref:a,className:(0,s.cn)("px-2 py-1.5 text-sm font-semibold text-[#94a3b8]",n&&"pl-8",t),...o})}).displayName=i.__.displayName;let f=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(i.Z0,{ref:a,className:(0,s.cn)("-mx-1 my-1 h-px bg-[#2a2d3a]",t),...n})});f.displayName=i.Z0.displayName},82302:function(e,a,t){t.d(a,{X:function(){return r}});async function r(e,a){return new Promise((a,t)=>{let r=new Image;r.onload=()=>{let e=document.createElement("canvas");e.width=r.width,e.height=r.height;let n=e.getContext("2d");if(!n){t(Error("No canvas context"));return}n.drawImage(r,0,0),e.toBlob(e=>e?a(e):t(Error("toBlob failed")),"image/png",.9)},r.onerror=()=>t(Error("Image load failed")),r.src=URL.createObjectURL(e)})}}}]);