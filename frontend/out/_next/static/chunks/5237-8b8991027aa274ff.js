"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5237,5922,5498],{1806:function(e,t,i){i.d(t,{_:function(){return g}});var r=i(57437),n=i(2265),a=i(17810),o=i(63572),l=i(86095),s=i(25703),u=i(98777),d=i(24033),c=i(50116),f=i(35498);function g(e){let{listingId:t,initialFavorite:i=!1,size:g="md",showText:v=!1,onToggle:m}=e,{isAuthenticated:h}=(0,l.a)(),{toast:p}=(0,s.useToast)(),y=(0,d.useRouter)(),b=(0,c.useLocale)(),[w,x]=(0,n.useState)(i),[_,S]=(0,n.useState)(!1),[C,k]=(0,n.useState)(!1);(0,n.useEffect)(()=>{h&&t?N():x(JSON.parse(localStorage.getItem("guest_favorites")||"[]").includes(t))},[t,h]);let N=async()=>{try{var e;let i=await o.apiClient.checkFavorite(t);x(null!==(e=null==i?void 0:i.is_favorite)&&void 0!==e&&e)}catch(e){x(i)}},I=async e=>{if(e.preventDefault(),e.stopPropagation(),!h){p({title:"Login Required",description:"Please login to save favorites",variant:"destructive"}),y.push("/".concat(b,"/login"));return}S(!0),k(!0);try{let e=await o.apiClient.toggleFavorite(t);x(e.is_favorite);try{f.activityHelpers.logFavorite(t,e.is_favorite)}catch(e){}m&&m(e.is_favorite),p({title:e.is_favorite?"Added to favorites":"Removed from favorites",description:e.is_favorite?"You can view it in your favorites page":"Removed from your favorites"}),setTimeout(()=>k(!1),300)}catch(r){var i;let e=null===(i=r.response)||void 0===i?void 0:i.status,t=r.message||"Failed to update favorite";p({title:"Error",description:404===e?"Favorites service is not available. Please try again later.":500===e?"Server error. Please try again later.":t,variant:"destructive"}),k(!1)}finally{S(!1)}},j=v?"flex items-center gap-2 px-4 py-2 rounded-lg backdrop-blur-xl bg-white/5 border border-white/10 text-white hover:bg-white/10 transition-all disabled:opacity-50":"p-2 rounded-lg backdrop-blur-xl bg-white/5 border border-white/10 text-white hover:bg-white/10 transition-all disabled:opacity-50";return(0,r.jsxs)("button",{onClick:I,disabled:_,className:"relative ".concat(j," ").concat(w?"text-red-400 hover:text-red-300 border-red-500/30":"text-gray-300 hover:text-white"),"aria-label":w?"Remove from favorites":"Add to favorites",children:[(0,r.jsx)(u.E.div,{animate:C?{scale:[1,1.3,1]}:{},transition:{duration:.3},className:"flex items-center justify-center",children:(0,r.jsx)(a.Z,{className:"".concat({sm:"h-4 w-4",md:"h-5 w-5",lg:"h-6 w-6"}[g]," ").concat(w?"fill-current":"")})}),v&&(0,r.jsx)("span",{className:"text-sm font-medium",children:w?"Saved":"Save"})]})}},85754:function(e,t,i){i.d(t,{z:function(){return l}});var r=i(57437),n=i(2265),a=i(67256),o=i(1657);let l=n.forwardRef((e,t)=>{let{className:i,variant:n="default",size:l="default",asChild:s=!1,...u}=e,d=s?a.g7:"button";return(0,r.jsx)(d,{className:(0,o.cn)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{default:"bg-[#5B7FFF] text-white hover:bg-[#4a6fff]",destructive:"bg-red-600 text-white hover:bg-red-700",outline:"border border-slate-300 dark:border-[#2a2d3a] bg-transparent hover:bg-slate-100 dark:hover:bg-[#2a2d3a] text-slate-900 dark:text-white",secondary:"bg-slate-100 dark:bg-[#2a2d3a] text-slate-900 dark:text-white hover:bg-slate-200 dark:hover:bg-[#3a3d4a]",ghost:"hover:bg-slate-100 dark:hover:bg-[#2a2d3a] text-slate-900 dark:text-white",link:"text-[#5B7FFF] underline-offset-4 hover:underline"}[n],{default:"h-10 sm:h-10 px-4 py-2 min-h-[48px] sm:min-h-[40px]",sm:"h-9 sm:h-9 rounded-md px-3 min-h-[48px] sm:min-h-[36px]",lg:"h-11 sm:h-11 rounded-md px-8 min-h-[48px] sm:min-h-[44px]",icon:"h-10 w-10 sm:h-10 sm:w-10 min-h-[48px] min-w-[48px] sm:min-h-[40px] sm:min-w-[40px]"}[l],i),ref:t,...u})});l.displayName="Button"},6678:function(e,t,i){i.r(t),i.d(t,{AuthProvider:function(){return l},useAuthContext:function(){return s}});var r=i(57437),n=i(2265),a=i(45922);let o=(0,n.createContext)(null);function l(e){let{children:t}=e,[i,l]=(0,n.useState)(null),[s,u]=(0,n.useState)(null),[d,c]=(0,n.useState)(null),[f,g]=(0,n.useState)(!0),v=(0,n.useCallback)(async e=>{var t;let{data:i,error:r}=await a.supabase.from("users").select("role").eq("id",e).maybeSingle();return r||!i?null:null!==(t=i.role)&&void 0!==t?t:null},[]),m=(0,n.useCallback)(async()=>{try{let{data:{session:e},error:t}=await a.supabase.auth.getSession();if(t||!e){u(null),l(null),c(null);return}u(e),l(e.user),g(!1);try{let t=await v(e.user.id);c(t)}catch(e){c(null)}}catch(e){u(null),l(null),c(null)}finally{g(!1)}},[v]);(0,n.useEffect)(()=>{m();let{data:{subscription:e}}=a.supabase.auth.onAuthStateChange(async(e,t)=>{if("SIGNED_OUT"===e||!t){u(null),l(null),c(null),g(!1);return}u(t),l(t.user);try{let e=await v(t.user.id);c(e)}finally{g(!1)}}),t=setTimeout(()=>{g(e=>!e&&e)},8e3);return()=>{clearTimeout(t),e.unsubscribe()}},[m,v]);let h=(0,n.useCallback)(async()=>{g(!0),await a.supabase.auth.signOut(),u(null),l(null),c(null),g(!1)},[]),p=(0,n.useMemo)(()=>({user:i,session:s,role:d,isAdmin:"admin"===d,loading:f,signOut:h}),[i,s,d,f,h]);return(0,r.jsx)(o.Provider,{value:p,children:t})}function s(){let e=(0,n.useContext)(o);if(!e)throw Error("useAuthContext must be used within an AuthProvider");return e}},86095:function(e,t,i){i.d(t,{a:function(){return a}});var r=i(2265),n=i(63572);function a(){let[e,t]=(0,r.useState)(null),[a,o]=(0,r.useState)(!0),l=(0,r.useRef)(!1),s=(0,r.useRef)(!1),u=(0,r.useCallback)(async()=>{if(!l.current)try{l.current=!0;try{let{supabase:e}=await Promise.all([i.e(3226),i.e(5922)]).then(i.bind(i,45922)),{data:{session:r}}=await e.auth.getSession();if(null==r?void 0:r.user){t({id:0,email:r.user.email||""}),o(!1);return}}catch(e){}if(!(0,n.LP)()){t(null),o(!1);return}try{let e=await n.apiClient.getMe();if(e&&"object"==typeof e&&e.email)t(e);else throw Error("Invalid user data received")}catch(i){var e,r;((null==i?void 0:null===(e=i.response)||void 0===e?void 0:e.status)===401||(null==i?void 0:null===(r=i.response)||void 0===r?void 0:r.status)===403)&&((0,n.gy)(),t(null))}}catch(e){(0,n.LP)()&&(0,n.gy)(),t(null)}finally{o(!1),l.current=!1}},[]);return(0,r.useEffect)(()=>{s.current||(s.current=!0,u())},[]),(0,r.useEffect)(()=>{let e=()=>{l.current||u()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[u]),{user:e,loading:a,login:async function(e,i){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{if(!e||!i)throw Error("Email and password are required");let a=await n.apiClient.login(e,i,r||!1);if(a&&a.user&&"object"==typeof a.user)t(a.user);else throw Error("Invalid user data in response");return await u(),a}catch(e){throw console.error("[useAuth.login] Login error:",e),e}},register:async function(e,i,r,a){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];try{if(!e||!i)throw Error("Email and password are required");let l=await n.apiClient.register(e,i,r,a,o);return l&&l.user&&"object"==typeof l.user&&t(l.user),l}catch(e){throw console.error("Register error:",e),e}},logout:async()=>{try{t(null),await n.apiClient.logout(),(0,n.gy)()}catch(e){console.error("Logout error:",e),t(null),(0,n.gy)()}},checkAuth:u,verify:async()=>{try{let e=await n.apiClient.verifyToken();if(e&&e.valid&&e.user&&"object"==typeof e.user)return t(e.user),!0;return!1}catch(e){return console.error("Verify error:",e),t(null),!1}},isAuthenticated:!!e}}},25703:function(e,t,i){i.r(t),i.d(t,{ToastProvider:function(){return l},useToast:function(){return s}});var r=i(57437),n=i(2265),a=i(1657);let o=n.createContext({toast:()=>{}});function l(e){let{children:t}=e,[i,l]=n.useState([]),s=n.useCallback(e=>{var t;let i=Math.random().toString(36).substring(7);l(t=>[...t,{...e,id:i}]),setTimeout(()=>{l(e=>e.filter(e=>e.id!==i))},null!==(t=e.duration)&&void 0!==t?t:5e3)},[]);return(0,r.jsxs)(o.Provider,{value:{toast:s},children:[t,(0,r.jsx)("div",{className:"fixed bottom-0 right-0 z-[1200] flex w-full flex-col-reverse gap-2 p-4 sm:flex-col md:max-w-[420px]",children:i.map(e=>(0,r.jsxs)("div",{className:(0,a.cn)("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md p-6 pr-8 shadow-lg transition-all","destructive"===e.variant?"border border-red-500/50 bg-red-950/30":"border border-[#2a2d3a] bg-[#1a1d29]"),children:[(0,r.jsxs)("div",{className:"grid gap-1",children:[e.title&&(0,r.jsx)("div",{className:(0,a.cn)("text-sm font-semibold","destructive"===e.variant?"text-red-200":"text-white"),children:e.title}),e.description&&(0,r.jsx)("div",{className:(0,a.cn)("text-sm","destructive"===e.variant?"text-red-300/90":"text-[#94a3b8]"),children:e.description})]}),(0,r.jsx)("button",{onClick:()=>l(t=>t.filter(t=>t.id!==e.id)),className:"absolute right-2 top-2 rounded-md p-1 text-[#94a3b8] opacity-0 transition-opacity hover:text-white focus:opacity-100 focus:outline-none group-hover:opacity-100",children:"\xd7"})]},e.id))})]})}function s(){return n.useContext(o)||{toast:e=>{"destructive"===e.variant&&console.error("Error:",e.description)}}}},35498:function(e,t,i){i.d(t,{activityHelpers:function(){return s},j:function(){return a}});var r=i(45922);let n="carwiseiq_activity_log";function a(e){try{let t=JSON.parse(localStorage.getItem(n)||"[]"),i=Array.isArray(t)?t:[];if(e)return i.filter(t=>!t.user_id||t.user_id===e);return i}catch(e){return[]}}let o=!1;async function l(e){var t,i,a,l;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u={type:e,entity_id:(null===(t=s.entity_id)||void 0===t?void 0:t.toString())||null,metadata:s};try{let{data:{session:t}}=await r.supabase.auth.getSession(),s=null==t?void 0:null===(i=t.user)||void 0===i?void 0:i.id;if(!function(e){try{let t=JSON.parse(localStorage.getItem(n)||"[]"),i={...e,id:"local_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2)),created_at:new Date().toISOString()};t.unshift(i),localStorage.setItem(n,JSON.stringify(t.slice(0,200)))}catch(e){}}({...u,user_id:s}),o||!s)return;let{error:d}=await r.supabase.from("user_activity").insert({user_id:s,type:e,entity_id:u.entity_id,metadata:u.metadata});if(!d)return;("PGRST205"===d.code||(null===(a=d.message)||void 0===a?void 0:a.includes("Could not find the table"))||(null===(l=d.message)||void 0===l?void 0:l.includes("404")))&&(o=!0)}catch(e){}}let s={logPrediction:e=>{var t;return l("prediction",{entity_id:(null===(t=e.predictionId)||void 0===t?void 0:t.toString())||null,car_make:e.make,car_model:e.model,car_year:e.year,predicted_price:e.predictedPrice})},logCompare:(e,t)=>l("compare",{entity_id:e.join(","),comparison_count:t,compared_ids:e.map(e=>e.toString())}),logViewListing:(e,t)=>l("view_listing",{entity_id:e.toString(),listing_title:t}),logFavorite:(e,t)=>l("favorite",{entity_id:e.toString(),action:t?"added":"removed"}),logCreateListing:(e,t,i)=>l("create_listing",{entity_id:e.toString(),listing_title:t,listing_price:i}),logEditListing:(e,t)=>l("edit_listing",{entity_id:e.toString(),listing_title:t}),logMarkSold:(e,t)=>l("mark_sold",{entity_id:e.toString(),listing_title:t}),logPredictionCreated:e=>s.logPrediction(e),logPredictionSaved:e=>l("prediction",{entity_id:e.toString()}),logComparisonSaved:(e,t)=>s.logCompare(t,e),logComparisonViewed:e=>s.logCompare(e,e.length),logListingViewed:(e,t)=>s.logViewListing(e,t),logListingCreated:(e,t,i)=>s.logCreateListing(e,t,i),logListingEdited:(e,t)=>s.logEditListing(e,t),logListingSold:(e,t)=>s.logMarkSold(e,t),logListingAvailable:(e,t)=>l("edit_listing",{entity_id:e.toString(),listing_title:t,action:"marked_available"}),logFavoriteAdded:e=>s.logFavorite(e,!0),logFavoriteRemoved:e=>s.logFavorite(e,!1)}},45922:function(e,t,i){i.d(t,{supabase:function(){return r}});let r=(0,i(33226).eI)("https://fehkzrrahgyesxzrwlme.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZlaGt6cnJhaGd5ZXN4enJ3bG1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkxNzcwNjEsImV4cCI6MjA4NDc1MzA2MX0.AI8QaX8nOP8UwcfmgbGN2EN4jmK94i98Kpd3ZtPDZRQ",{auth:{lock:(e,t,i)=>i()}})},1657:function(e,t,i){i.d(t,{cb:function(){return d},cn:function(){return a},gQ:function(){return u},uf:function(){return l},wo:function(){return c},xG:function(){return o}});var r=i(57042),n=i(74769);function a(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(0,n.m6)((0,r.W)(t))}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"USD";return new Intl.NumberFormat("en-US",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function l(e){return new Intl.NumberFormat("en-US").format(e)}function s(e){return e<=0||!isFinite(e)?0:Math.round(235.214583/e*10)/10}function u(e,t){let i=s(e),r=s(t);return"".concat(i," / ").concat(r," L/100km")}function d(e){return null!=e&&"string"==typeof e&&/\.(mp4|mov|avi)(\?|$)/i.test(e)}function c(e,t){var i;if(null==e||"string"!=typeof e||!e)return"";if(e.startsWith("http://")||e.startsWith("https://"))return e;let r=(null!==(i=null!=t?t:"http://localhost:8000")&&void 0!==i?i:"").replace(/\/$/,"");return r?r+(e.startsWith("/")?e:"/"+e):e}}}]);