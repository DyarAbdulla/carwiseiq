(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[667],{60720:function(e,t,a){Promise.resolve().then(a.bind(a,10640))},10640:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return C}});var s=a(57437),r=a(2265),i=a(24033),l=a(50116),o=a(45179),n=a(49842),d=a(85754),c=a(45509),m=a(17810),x=a(71813),h=a(4689),u=a(42482),g=a(96142),v=a(28203),p=a(63572),f=a(86095),b=a(6678),w=a(45922),j=a(25703),N=a(61396),y=a.n(N),k=a(1806),_=a(1657);function C(){let e=(0,i.useRouter)(),t=(0,l.useLocale)(),a=(0,l.useTranslations)("favorites"),N=(0,l.useTranslations)("common"),C=(0,l.useTranslations)("auth"),{isAuthenticated:F,loading:S}=(0,f.a)(),{user:z,session:E,loading:T}=(0,b.useAuthContext)(),{toast:R}=(0,j.useToast)();(0,r.useEffect)(()=>{(async()=>{try{var e;let{data:t}=await w.supabase.auth.getSession();null===(e=t.session)||void 0===e||e.access_token}catch(e){}})()},[]);let[L,I]=(0,r.useState)([]),[Z,O]=(0,r.useState)(0),[M,V]=(0,r.useState)(1),[A,B]=(0,r.useState)(!0),[D,P]=(0,r.useState)("grid"),[Q,U]=(0,r.useState)("recently_saved"),[Y,G]=(0,r.useState)({min_price:"",max_price:"",makes:[],location:""}),H=(0,r.useCallback)(async()=>{var s,r,i,l,o;let n=null;try{let{data:e}=await w.supabase.auth.getSession();n=(null===(s=e.session)||void 0===s?void 0:s.access_token)||null}catch(e){console.error("[Favorites] Error getting Supabase session:",e)}if(n||(n=localStorage.getItem("auth_token")),!n){console.error("[Favorites] âŒ No token found! Cannot load favorites."),R({title:N("error"),description:C("authTokenMissing"),variant:"destructive"}),e.replace("/".concat(t,"/login?returnUrl=/").concat(t,"/favorites")),B(!1);return}B(!0);try{let e=await p.apiClient.getFavorites({page:M,page_size:15,sort_by:Q}),t=e.items||[];Y.min_price&&(t=t.filter(e=>e.price>=parseFloat(Y.min_price))),Y.max_price&&(t=t.filter(e=>e.price<=parseFloat(Y.max_price))),Y.makes.length>0&&(t=t.filter(e=>Y.makes.includes(e.make))),Y.location&&(t=t.filter(e=>{var t,a;return(null===(t=e.location_city)||void 0===t?void 0:t.toLowerCase().includes(Y.location.toLowerCase()))||(null===(a=e.location_state)||void 0===a?void 0:a.toLowerCase().includes(Y.location.toLowerCase()))})),I(t),O(e.total||0)}catch(s){if(console.error("[Favorites] ========== ERROR LOADING FAVORITES =========="),console.error("[Favorites] Error:",s),console.error("[Favorites] Error response:",s.response),console.error("[Favorites] Error status:",null===(r=s.response)||void 0===r?void 0:r.status),console.error("[Favorites] Error message:",s.message),(null===(i=s.response)||void 0===i?void 0:i.status)===401)R({title:N("error"),description:a("sessionExpired")||"Session expired. Please login again.",variant:"destructive"}),I([]),O(0),e.replace("/".concat(t,"/login?returnUrl=/").concat(t,"/favorites"));else{let e=(null===(o=s.response)||void 0===o?void 0:null===(l=o.data)||void 0===l?void 0:l.detail)||s.message||a("loadError");console.error("[Favorites] Error message:",e),R({title:N("error"),description:e,variant:"destructive"}),I([]),O(0)}}finally{B(!1)}},[M,Q,Y,R,a,N,e,t]);(0,r.useEffect)(()=>{let a=!0,s=null,r=async()=>{try{var i,l;let{data:e}=await w.supabase.auth.getSession(),t=!!(null===(i=e.session)||void 0===i?void 0:i.user),s=!!(null===(l=e.session)||void 0===l?void 0:l.access_token);if(t&&s&&a){H();return}}catch(e){}if(T){s=setTimeout(()=>{a&&r()},1e3);return}if(F&&!S&&a){H();return}if(S){s=setTimeout(()=>{a&&r()},1e3);return}a&&e.replace("/".concat(t,"/login?returnUrl=/").concat(t,"/favorites"))};return r(),()=>{a=!1,s&&clearTimeout(s)}},[T,z,E,S,F,e,t,H]);let J=e=>{let t=new Date,s=new Date(e),r=Math.floor((t.getTime()-s.getTime())/864e5);return 0===r?a("savedToday"):1===r?a("savedYesterday"):r<7?a("savedDaysAgo",{n:r}):r<30?a("savedWeeksAgo",{n:Math.floor(r/7)}):a("savedMonthsAgo",{n:Math.floor(r/30)})};return S?(0,s.jsxs)("div",{className:"relative min-h-screen flex items-center justify-center",children:[(0,s.jsx)("div",{className:"absolute inset-0 -z-10 overflow-hidden pointer-events-none",children:(0,s.jsx)("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-[1000px] h-[600px] bg-gradient-radial from-indigo-500/15 via-purple-500/10 to-transparent blur-3xl"})}),(0,s.jsx)("div",{className:"text-gray-400 text-lg",children:N("loading")})]}):F?(0,s.jsxs)("div",{className:"relative min-h-screen text-gray-100",children:[(0,s.jsx)("div",{className:"absolute inset-0 -z-10 overflow-hidden pointer-events-none",children:(0,s.jsx)("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-[1000px] h-[600px] bg-gradient-radial from-indigo-500/15 via-purple-500/10 to-transparent blur-3xl"})}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 pt-8 pb-12 md:pt-12 md:pb-16",children:[(0,s.jsxs)("div",{className:"mb-8 md:mb-10",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,s.jsx)(m.Z,{className:"h-8 w-8 text-red-500 fill-current"}),(0,s.jsx)("h1",{className:"text-3xl md:text-4xl font-bold text-white tracking-tight",children:a("title")})]}),(0,s.jsx)("p",{className:"text-gray-400 text-lg",children:a("subtitle")})]}),(0,s.jsxs)("div",{className:"backdrop-blur-xl bg-white/5 border border-white/10 rounded-2xl p-4 md:p-5 mb-6 shadow-2xl",children:[(0,s.jsx)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-3 flex-1",children:[(0,s.jsxs)(c.Ph,{value:Q,onValueChange:U,children:[(0,s.jsx)(c.i4,{className:"min-w-[180px] h-12 bg-white/5 border-white/10 text-white",children:(0,s.jsx)(c.ki,{placeholder:a("sortBy")})}),(0,s.jsxs)(c.Bw,{className:"bg-slate-900/98 border-white/10 backdrop-blur-xl",children:[(0,s.jsx)(c.Ql,{value:"recently_saved",className:"text-white",children:a("recentlySaved")}),(0,s.jsx)(c.Ql,{value:"price_low",className:"text-white",children:a("priceLow")}),(0,s.jsx)(c.Ql,{value:"price_high",className:"text-white",children:a("priceHigh")}),(0,s.jsx)(c.Ql,{value:"newest_listings",className:"text-white",children:a("newestListings")})]})]}),(0,s.jsxs)("div",{className:"flex rounded-xl border border-white/10 p-1 bg-white/5",children:[(0,s.jsx)(d.z,{variant:"grid"===D?"default":"ghost",size:"icon",onClick:()=>P("grid"),className:"h-10 w-10 ".concat("grid"===D?"bg-indigo-600 text-white":"text-gray-400 hover:text-white"),"aria-label":a("gridView"),children:(0,s.jsx)(x.Z,{className:"h-4 w-4"})}),(0,s.jsx)(d.z,{variant:"list"===D?"default":"ghost",size:"icon",onClick:()=>P("list"),className:"h-10 w-10 ".concat("list"===D?"bg-indigo-600 text-white":"text-gray-400 hover:text-white"),"aria-label":a("listView"),children:(0,s.jsx)(h.Z,{className:"h-4 w-4"})})]})]})}),(0,s.jsxs)("div",{className:"mt-4 pt-4 border-t border-white/10",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)(u.Z,{className:"h-4 w-4 text-gray-400"}),(0,s.jsx)("span",{className:"text-white font-semibold text-sm",children:a("filters")})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(n._,{className:"text-gray-300 text-sm mb-2 block font-medium",children:a("priceRange")}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(o.I,{type:"number",placeholder:a("min"),value:Y.min_price,onChange:e=>G({...Y,min_price:e.target.value}),className:"h-11 bg-white/5 border-white/10 text-base"}),(0,s.jsx)(o.I,{type:"number",placeholder:a("max"),value:Y.max_price,onChange:e=>G({...Y,max_price:e.target.value}),className:"h-11 bg-white/5 border-white/10 text-base"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(n._,{className:"text-gray-300 text-sm mb-2 block font-medium",children:a("location")}),(0,s.jsx)(o.I,{type:"text",placeholder:a("cityOrState"),value:Y.location,onChange:e=>G({...Y,location:e.target.value}),className:"h-11 bg-white/5 border-white/10 text-base"})]}),(0,s.jsx)("div",{className:"flex items-end",children:(0,s.jsx)(d.z,{onClick:()=>G({min_price:"",max_price:"",makes:[],location:""}),variant:"outline",className:"h-11 border-white/10 text-gray-300 hover:bg-white/5",children:a("clearFilters")})})]})]})]}),A?(0,s.jsx)("div",{className:"text-center py-20 text-gray-400 text-lg",children:a("loadingFavorites")}):0===L.length?(0,s.jsxs)("div",{className:"backdrop-blur-xl bg-white/5 border border-white/10 rounded-2xl p-12 md:p-16 text-center shadow-xl",children:[(0,s.jsx)("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full bg-white/5 flex items-center justify-center",children:(0,s.jsx)(m.Z,{className:"h-12 w-12 text-gray-500"})}),(0,s.jsx)("h3",{className:"text-2xl font-bold text-white mb-3",children:a("noFavorites")}),(0,s.jsx)("p",{className:"text-gray-400 mb-8 max-w-md mx-auto text-base",children:a("noFavoritesDesc")}),(0,s.jsx)(d.z,{onClick:()=>e.push("/".concat(t,"/buy-sell")),className:"h-12 px-8 bg-indigo-600 hover:bg-indigo-500 text-white font-medium shadow-lg shadow-indigo-500/20",children:a("browseListings")})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"mb-4 text-gray-400 text-sm font-medium",children:a("showingXofY",{count:L.length,total:Z})}),(0,s.jsx)("div",{className:"grid"===D?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6":"space-y-4",children:L.map(e=>{var r,i;return(0,s.jsx)(y(),{href:"/".concat(t,"/buy-sell/").concat(e.id),children:(0,s.jsx)("div",{className:"group relative backdrop-blur-md bg-white/5 border border-white/10 rounded-2xl overflow-hidden transition-all duration-300 ease-out cursor-pointer hover:-translate-y-1 hover:ring-2 hover:ring-indigo-500/50 hover:shadow-xl hover:shadow-indigo-500/20 active:scale-[0.98]",children:(0,s.jsxs)("div",{className:"grid"===D?"":"flex",children:[(0,s.jsx)("div",{className:"".concat("grid"===D?"aspect-video":"w-64"," bg-gray-900/50 overflow-hidden relative"),children:e.cover_image?(0,s.jsx)("img",{src:(0,_.wo)(e.cover_image),alt:"".concat(e.make," ").concat(e.model),className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",onError:e=>{e.target.src="/images/cars/default-car.jpg",e.target.onerror=null}}):(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center text-gray-500 text-sm",children:a("noImage")})}),(0,s.jsxs)("div",{className:"p-4 ".concat("list"===D?"flex-1":""),children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-white font-bold text-lg group-hover:text-indigo-400 transition-colors",children:[e.year," ",e.make," ",e.model]}),(0,s.jsxs)("p",{className:"text-indigo-400 font-bold text-xl",children:["$",null===(r=e.price)||void 0===r?void 0:r.toLocaleString()]})]}),(0,s.jsx)(k._,{listingId:e.id,initialFavorite:!0,size:"md",onToggle:t=>{t||(I(L.filter(t=>t.id!==e.id)),O(Z-1))}})]}),(0,s.jsxs)("div",{className:"space-y-1.5 text-sm text-gray-300",children:[(0,s.jsxs)("p",{className:"font-medium",children:[null===(i=e.mileage)||void 0===i?void 0:i.toLocaleString()," ",e.mileage_unit]}),(0,s.jsxs)("p",{className:"flex items-center text-gray-400",children:[(0,s.jsx)(g.Z,{className:"h-3.5 w-3.5 mr-1.5"}),e.location_city,", ",e.location_state]}),(0,s.jsxs)("p",{className:"flex items-center text-xs text-gray-500",children:[(0,s.jsx)(v.Z,{className:"h-3 w-3 mr-1"}),J(e.saved_at||e.created_at)]})]}),(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsx)("span",{className:"inline-block px-2.5 py-1 rounded-lg text-xs font-semibold ".concat("Excellent"===e.condition?"bg-emerald-500/20 text-emerald-400":"Good"===e.condition?"bg-indigo-500/20 text-indigo-400":"Fair"===e.condition?"bg-amber-500/20 text-amber-400":"bg-gray-500/20 text-gray-400"),children:e.condition})})]})]})})},e.id)})}),Z>15&&(0,s.jsxs)("div",{className:"flex justify-center items-center gap-3 mt-10",children:[(0,s.jsx)(d.z,{variant:"outline",onClick:()=>V(e=>Math.max(1,e-1)),disabled:1===M,className:"border-white/10 text-gray-300 hover:bg-white/5 h-11 px-6 disabled:opacity-50",children:a("previous")}),(0,s.jsx)("span",{className:"px-4 py-2 text-gray-300 text-sm font-medium",children:a("pageOf",{page:M,total:Math.ceil(Z/15)})}),(0,s.jsx)(d.z,{variant:"outline",onClick:()=>V(e=>e+1),disabled:15*M>=Z,className:"border-white/10 text-gray-300 hover:bg-white/5 h-11 px-6 disabled:opacity-50",children:a("next")})]})]})]})]}):(0,s.jsxs)("div",{className:"relative min-h-screen flex items-center justify-center",children:[(0,s.jsx)("div",{className:"absolute inset-0 -z-10 overflow-hidden pointer-events-none",children:(0,s.jsx)("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-[1000px] h-[600px] bg-gradient-radial from-indigo-500/15 via-purple-500/10 to-transparent blur-3xl"})}),(0,s.jsx)("div",{className:"text-gray-400 text-lg",children:"Redirecting to login..."})]})}},45179:function(e,t,a){"use strict";a.d(t,{I:function(){return l}});var s=a(57437),r=a(2265),i=a(1657);let l=r.forwardRef((e,t)=>{let{className:a,type:r,...l}=e;return(0,s.jsx)("input",{type:r,className:(0,i.cn)("flex w-full rounded-lg border border-slate-200 dark:border-white/10 bg-white dark:bg-white/[0.03] backdrop-blur-sm px-4 py-3 min-h-[48px] text-base text-start text-slate-900 dark:text-white/90 ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-slate-400 dark:placeholder:text-white/40 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500/30 focus-visible:ring-offset-2 focus-visible:border-indigo-500 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-300 hover:border-indigo-500/50 dark:hover:border-indigo-500/50 hover:bg-slate-50 dark:hover:bg-white/[0.05] touch-manipulation",a),ref:t,...l})});l.displayName="Input"},49842:function(e,t,a){"use strict";a.d(t,{_:function(){return l}});var s=a(57437),r=a(2265),i=a(1657);let l=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("label",{ref:t,className:(0,i.cn)("text-sm font-medium leading-none text-white peer-disabled:cursor-not-allowed peer-disabled:opacity-70",a),...r})});l.displayName="Label"},45509:function(e,t,a){"use strict";a.d(t,{Bw:function(){return h},Ph:function(){return c},Ql:function(){return u},i4:function(){return m},ki:function(){return x}});var s=a(57437),r=a(2265),i=a(58527),l=a(1657),o=a(83523),n=a(62442);let d=r.createContext(void 0),c=e=>{let{value:t,onValueChange:a,disabled:r,children:l,id:o,name:n}=e;return(0,s.jsx)(d.Provider,{value:{value:t,onValueChange:a,id:o},children:(0,s.jsx)(i.fC,{value:t,onValueChange:a,disabled:r,name:n,children:l})})};c.displayName="Select";let m=r.forwardRef((e,t)=>{let{className:a,children:n,...c}=e,m=r.useContext(d);return(0,s.jsxs)(i.xz,{ref:t,id:null==m?void 0:m.id,className:(0,l.cn)("flex min-h-[44px] w-full items-center justify-between rounded-lg border border-slate-200/80 dark:border-white/10 bg-slate-50/90 dark:bg-white/[0.05] backdrop-blur-sm px-4 py-3 text-base text-slate-900 dark:text-slate-100 ring-offset-2 ring-offset-white dark:ring-offset-slate-950 placeholder:text-slate-500 dark:placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/30 focus:border-indigo-400 dark:focus:border-indigo-500 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 transition-all duration-200 hover:border-slate-300 dark:hover:border-white/20 hover:bg-slate-100/80 dark:hover:bg-white/[0.08]",a),...c,children:[n,(0,s.jsx)(i.JO,{asChild:!0,children:(0,s.jsx)(o.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=i.xz.displayName;let x=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i.B4,{ref:t,className:(0,l.cn)("block truncate",a),...r})});x.displayName=i.B4.displayName;let h=r.forwardRef((e,t)=>{let{className:a,children:r,...o}=e;return(0,s.jsx)(i.h_,{children:(0,s.jsx)(i.VY,{ref:t,className:(0,l.cn)("relative z-[1200] min-w-[8rem] overflow-hidden rounded-card border border-slate-200/80 dark:border-white/10 bg-white/98 dark:bg-slate-900/98 backdrop-blur-xl text-slate-900 dark:text-slate-100 shadow-glass","max-h-[60vh]","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","max-md:!transform-none max-md:!fixed max-md:!left-0 max-md:!right-0 max-md:!bottom-0 max-md:!top-auto max-md:!w-full max-md:!min-w-0 max-md:!h-[60vh] max-md:!max-h-[60vh] max-md:!rounded-t-2xl max-md:!rounded-b-none max-md:pb-[env(safe-area-inset-bottom)] max-md:data-[state=open]:slide-in-from-bottom max-md:border-t",a),...o,position:"item-aligned",children:(0,s.jsx)(i.l_,{className:(0,l.cn)("p-1 overflow-y-auto overscroll-contain max-h-[60vh]","max-md:!w-full max-md:min-w-0 max-md:!max-h-[60vh] max-md:overflow-y-auto"),children:r})})})});h.displayName=i.VY.displayName;let u=r.forwardRef((e,t)=>{let{className:a,children:r,...o}=e;return(0,s.jsxs)(i.ck,{ref:t,className:(0,l.cn)("relative flex w-full cursor-pointer select-none items-center rounded-lg py-3 md:py-2.5 pl-8 pr-3 text-sm min-h-[44px] md:min-h-0 outline-none focus:bg-slate-100 dark:focus:bg-white/10 focus:text-slate-900 dark:focus:text-slate-100 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [touch-action:manipulation]",a),...o,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(i.wU,{children:(0,s.jsx)(n.Z,{className:"h-4 w-4"})})}),(0,s.jsx)(i.eT,{children:r})]})});u.displayName=i.ck.displayName}},function(e){e.O(0,[7895,116,263,4829,3226,7169,7633,1396,8777,555,9782,4824,3572,5237,2971,4938,1744],function(){return e(e.s=60720)}),_N_E=e.O()}]);