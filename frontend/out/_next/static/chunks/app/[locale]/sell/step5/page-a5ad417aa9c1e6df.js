(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9044,5922],{13008:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,r(62898).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},62442:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,r(62898).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},83523:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,r(62898).Z)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},9224:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,r(62898).Z)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]])},86264:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,r(62898).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},96142:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,r(62898).Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},49617:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,r(62898).Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},79094:function(e,t,r){Promise.resolve().then(r.bind(r,69133))},69133:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return w}});var i=r(57437),n=r(2265),s=r(24033),a=r(50116),l=r(61396),o=r.n(l),c=r(85754),d=r(54900),u=r(65864),h=r(6678),m=r(45922),p=r(25703),f=r(49617),x=r(96142),b=r(9224),g=r(83523),v=r(86264),y=r(13008);function j(e){let t=e.replace(/\D/g,"");return t.length<4?e:"+964 XXX XXX **".concat(t.slice(-2))}function w(){var e,t;let l=(0,s.useRouter)(),w=(0,a.useLocale)(),k=(0,a.useTranslations)("sell"),N=(0,a.useTranslations)("footer"),{toast:C}=(0,p.useToast)(),{user:S}=(0,h.useAuthContext)(),{location:I,media:E,uploadedMediaUrls:L,carDetails:D,contact:F,setPublishedListingId:P,clearDraft:_}=(0,u.e)(),[R,T]=(0,n.useState)(!1),[z,M]=(0,n.useState)(!1),[Z,A]=(0,n.useState)(!1),[U,B]=(0,n.useState)(!1),W=(0,n.useRef)(!1),O=R&&z&&!!(null==I?void 0:I.city)&&!!(null==D?void 0:D.make)&&!!(null==D?void 0:D.model)&&!!(null==D?void 0:D.year)&&!!(null==F?void 0:F.phone)&&L.length>0,H=(0,n.useCallback)(async()=>{var e,t,i,n,s,a,o,c,d,u,h,p,f,x,b;let{data:g,error:v}=await m.supabase.auth.getSession();if(v||!(null==g?void 0:null===(t=g.session)||void 0===t?void 0:null===(e=t.user)||void 0===e?void 0:e.id)){console.error("=== PUBLISH FAILED ===","No active Supabase session",v),C({title:k("publishSessionError"),description:(null==v?void 0:v.message)||"Please sign in again",variant:"destructive"});return}let y=g.session.user.id;if(!O||!I||!D||!F){console.error("=== PUBLISH FAILED ===","canPublish or required data missing",{canPublish:O,hasLocation:!!I,hasCarDetails:!!D,hasContact:!!F});return}if(!W.current){W.current=!0,B(!0);try{let e=parseInt(String(D.year),10),t=parseFloat(String(D.price)),g=parseInt(String(D.mileage),10);if(!Number.isFinite(e)||!Number.isFinite(t)||!Number.isFinite(g)){console.error("=== PUBLISH FAILED ===","Validation: invalid year/price/mileage",{year:e,price:t,mileage:g}),C({title:k("publishValidationError"),description:"",variant:"destructive"}),W.current=!1,B(!1);return}let v="".concat(I.city).concat(I.neighborhood?", ".concat(I.neighborhood):"",", Iraq"),j=[];D.color&&j.push("Color: ".concat(D.color)),D.previous_owners&&j.push("Previous owners: ".concat(D.previous_owners)),D.accident_history&&j.push("Accident: ".concat(D.accident_history)),(null===(i=D.features)||void 0===i?void 0:i.length)&&j.push("Features: ".concat(D.features.join(", ")));let N=[F.description,j.length?j.join(". "):null].filter(Boolean).join("\n\n")||null,S="".concat(D.year," ").concat(D.make," ").concat(D.model).trim(),E=F.phone.replace(/\D/g,"").replace(/^964/,"").slice(-10),R="+964".concat(E),T=F.whatsappSameAsPhone?R:(F.whatsapp||"").replace(/\D/g,"").length>=10?"+964".concat(F.whatsapp.replace(/\D/g,"").replace(/^964/,"").slice(-10)):R,z={user_id:y,title:S,make:String(null!==(s=D.make)&&void 0!==s?s:"").trim(),model:String(null!==(a=D.model)&&void 0!==a?a:"").trim(),year:Number(e),price:Number(t),mileage:Number(g),transmission:(f=D.transmission,"Manual"===f?"manual":"automatic"),fuel_type:(x=D.fuel_type,"Diesel"===x?"diesel":"Electric (EV)"===x?"electric":"Hybrid"===x||"Plug-in Hybrid (PHEV)"===x?"hybrid":"petrol"),condition:(b=D.condition,"Good"===b?"good":"Fair"===b||"Needs Work"===b?"fair":"excellent"),location:v,description:N,images:Array.isArray(L)?L:[],is_sold:!1,status:"active",phone:R||null,whatsapp:T||null},M=m.supabase.from("car_listings").insert(z).select("id").single(),Z=new Promise((e,t)=>{setTimeout(()=>{t(Error("Insert timeout after 20 seconds. This usually indicates an RLS policy issue. Please check Supabase RLS policies for car_listings table."))},2e4)}),A=null;try{A=await Promise.race([M.then(e=>({data:e.data,error:e.error})),Z])}catch(e){if(e instanceof Error&&e.message.includes("timeout")){console.error("=== PUBLISH FAILED - Timeout ==="),console.error("The insert operation timed out. This usually means:"),console.error("1. RLS policy is blocking the insert (check: auth.uid() = user_id)"),console.error("2. Database trigger is hanging"),console.error("3. Network issue"),W.current=!1,B(!1),C({title:"Request Timeout",description:"The request took too long. Please check Supabase RLS policies for car_listings table. Ensure INSERT policy exists: WITH CHECK (auth.uid() = user_id)",variant:"destructive"});return}throw e}if(null==A?void 0:A.error){let e=A.error;console.error("=== PUBLISH FAILED - Supabase Error ==="),console.error("Error code:",e.code),console.error("Error message:",e.message),console.error("Error details:",e.details),console.error("Error hint:",e.hint),console.error("Full error object:",JSON.stringify(e,null,2));let t=e.message||"Failed to publish listing";"PGRST301"===e.code||(null===(o=e.message)||void 0===o?void 0:o.includes("permission"))||(null===(c=e.message)||void 0===c?void 0:c.includes("policy"))||(null===(d=e.message)||void 0===d?void 0:d.includes("RLS"))?t="Permission denied. The RLS policy may be blocking this insert. Please ensure: 1) You're signed in, 2) RLS INSERT policy exists with: WITH CHECK (auth.uid() = user_id)":(null===(u=e.message)||void 0===u?void 0:u.includes("timeout"))?t="Request timed out. Please check your connection and RLS policies.":(null===(h=e.message)||void 0===h?void 0:h.includes("row-level"))||(null===(p=e.message)||void 0===p?void 0:p.includes("RLS"))?t="Database security policy error. Please check Supabase RLS policies.":"23505"===e.code?t="Duplicate entry. This listing may already exist.":"23503"===e.code&&(t="Foreign key constraint failed. User ID may be invalid."),W.current=!1,B(!1),C({title:k("publishDbError")||"Publish Failed",description:t,variant:"destructive"});return}if(!(null==A?void 0:null===(n=A.data)||void 0===n?void 0:n.id)){console.error("=== PUBLISH FAILED ===","Insert returned no id",null==A?void 0:A.data),W.current=!1,B(!1),C({title:k("publishDbError")||"Publish Failed",description:"No listing id returned from database",variant:"destructive"});return}let U=A.data.id,{activityHelpers:O}=await r.e(5498).then(r.bind(r,35498));O.logCreateListing(U,S,Number(t)),P(U),_(),B(!1),C({title:"Listing published",description:"Your car is now live on CarWiseIQ."}),l.push("/".concat(w,"/sell/success?id=").concat(U))}catch(e){console.error("=== PUBLISH FAILED - Exception ===",e),e instanceof Error&&(console.error("Error name:",e.name),console.error("Error message:",e.message),console.error("Error stack:",e.stack)),console.error("Full error:",e instanceof Error?{message:e.message,name:e.name,stack:e.stack}:e),W.current=!1,B(!1),C({title:"Error",description:e instanceof Error?e.message:String(e),variant:"destructive"})}finally{B(!1)}}},[O,I,E.length,L,D,F,P,_,l,w,C,k]);return I&&D&&F?(0,i.jsxs)("div",{className:"relative px-4 py-12 md:py-16",children:[(0,i.jsx)("div",{className:"absolute inset-0 -z-10 overflow-hidden pointer-events-none",children:(0,i.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[600px] bg-gradient-radial from-indigo-500/20 via-purple-500/10 to-transparent blur-3xl opacity-60"})}),(0,i.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,i.jsxs)("div",{className:"text-center mb-10",children:[(0,i.jsx)("h1",{className:"text-3xl md:text-4xl font-bold text-white tracking-tight mb-3",children:k("reviewTitle")}),(0,i.jsx)("p",{className:"text-gray-400 text-lg",children:k("reviewDescription")})]}),(0,i.jsxs)("div",{className:"backdrop-blur-xl bg-black/30 border border-white/10 rounded-2xl p-6 shadow-xl",children:[(0,i.jsxs)("div",{className:"flex flex-row items-center justify-between mb-4",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-white",children:k("photosVideos")}),(0,i.jsx)(c.z,{variant:"outline",size:"sm",asChild:!0,className:"border-white/10 text-gray-300 hover:bg-white/5",children:(0,i.jsxs)(o(),{href:"/".concat(w,"/sell/step2"),children:[(0,i.jsx)(f.Z,{className:"h-4 w-4 mr-1"})," ",k("edit")]})})]}),(0,i.jsx)("div",{children:E.length>0?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"grid grid-cols-4 gap-1.5",children:E.slice(0,8).map(e=>(0,i.jsxs)("div",{className:"aspect-square rounded-lg overflow-hidden bg-gray-700 relative",children:[e.isVideo?(0,i.jsx)("video",{src:e.previewUrl,muted:!0,className:"w-full h-full object-cover"}):(0,i.jsx)("img",{src:e.previewUrl,alt:"",className:"w-full h-full object-cover"}),e.isCover&&(0,i.jsx)("span",{className:"absolute top-1 left-1 px-1.5 py-0.5 rounded text-xs bg-indigo-600 text-white",children:k("cover")})]},e.id))}),0===L.length&&(0,i.jsxs)("p",{className:"mt-2 text-amber-400 text-sm",children:[(0,i.jsx)(o(),{href:"/".concat(w,"/sell/step2"),className:"underline",children:"Go to Media"})," and click Continue to upload."]})]}):(0,i.jsx)("p",{className:"text-gray-400",children:k("noMedia")})})]}),(0,i.jsxs)("div",{className:"backdrop-blur-xl bg-black/30 border border-white/10 rounded-2xl p-6 shadow-xl",children:[(0,i.jsxs)("div",{className:"flex flex-row items-center justify-between mb-4",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-white",children:k("carDetails")}),(0,i.jsx)(c.z,{variant:"outline",size:"sm",asChild:!0,className:"border-white/10 text-gray-300 hover:bg-white/5",children:(0,i.jsxs)(o(),{href:"/".concat(w,"/sell/step3"),children:[(0,i.jsx)(f.Z,{className:"h-4 w-4 mr-2"})," ",k("edit")]})})]}),(0,i.jsxs)("div",{className:"space-y-2 text-gray-300",children:[(0,i.jsxs)("p",{className:"text-white font-semibold",children:[D.year," ",D.make," ",D.model]}),(0,i.jsxs)("p",{className:"text-xl font-bold text-indigo-400",children:["$",D.price?parseFloat(D.price).toLocaleString():"0"]}),(0,i.jsxs)("p",{children:["Mileage: ",D.mileage?parseInt(D.mileage,10).toLocaleString():"0"," km"]}),(0,i.jsxs)("p",{children:["Transmission: ",D.transmission||"—"]}),(0,i.jsxs)("p",{children:["Fuel: ",D.fuel_type||"—"]}),(0,i.jsxs)("p",{children:["Condition: ",D.condition||"—"]}),(0,i.jsxs)("p",{children:["Color: ",D.color||"—"]}),(null===(e=D.features)||void 0===e?void 0:e.length)?(0,i.jsxs)("p",{children:["Features: ",D.features.join(", ")]}):null]})]}),(0,i.jsxs)("div",{className:"backdrop-blur-xl bg-black/30 border border-white/10 rounded-2xl p-6 shadow-xl",children:[(0,i.jsxs)("div",{className:"flex flex-row items-center justify-between mb-4",children:[(0,i.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,i.jsx)(x.Z,{className:"h-4 w-4"})," ",k("location")]}),(0,i.jsx)(c.z,{variant:"outline",size:"sm",asChild:!0,className:"border-white/10 text-gray-300 hover:bg-white/5",children:(0,i.jsxs)(o(),{href:"/".concat(w,"/sell/step1"),children:[(0,i.jsx)(f.Z,{className:"h-4 w-4 mr-2"})," ",k("edit")]})})]}),(0,i.jsxs)("div",{className:"text-gray-300",children:[I.city,I.neighborhood?", ".concat(I.neighborhood):"",", Iraq"]})]}),(0,i.jsxs)("div",{className:"backdrop-blur-xl bg-black/30 border border-white/10 rounded-2xl p-6 shadow-xl",children:[(0,i.jsxs)("div",{className:"flex flex-row items-center justify-between mb-4",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-white",children:k("contact")}),(0,i.jsx)(c.z,{variant:"outline",size:"sm",asChild:!0,className:"border-white/10 text-gray-300 hover:bg-white/5",children:(0,i.jsxs)(o(),{href:"/".concat(w,"/sell/step4"),children:[(0,i.jsx)(f.Z,{className:"h-4 w-4 mr-2"})," ",k("edit")]})})]}),(0,i.jsxs)("div",{className:"space-y-1 text-gray-300",children:[(0,i.jsxs)("p",{children:["Phone: ",j(F.phone)]}),!F.whatsappSameAsPhone&&F.whatsapp&&(0,i.jsxs)("p",{children:["WhatsApp: ",j(F.whatsapp)]}),F.preferredContact&&(0,i.jsxs)("p",{children:["Preferred: ",F.preferredContact]}),(null===(t=F.bestTimeToCall)||void 0===t?void 0:t.length)?(0,i.jsxs)("p",{children:["Best time: ",F.bestTimeToCall.join(", ")]}):null,F.description&&(0,i.jsxs)("p",{className:"mt-2 text-sm",children:[F.description.slice(0,120),"…"]})]})]}),(0,i.jsxs)("div",{className:"backdrop-blur-xl bg-black/30 border border-white/10 rounded-2xl p-6 shadow-xl",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:k("agreements")}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("label",{className:"flex items-start gap-3 cursor-pointer",children:[(0,i.jsx)(d.X,{checked:R,onCheckedChange:e=>T(!!e)}),(0,i.jsxs)("span",{className:"text-gray-300 text-sm",children:[k("agreeTermsBefore"),(0,i.jsx)(o(),{href:"/".concat(w,"/privacy"),className:"text-indigo-400 hover:underline",children:N("privacy")}),k("agreeTermsMid"),(0,i.jsx)(o(),{href:"/".concat(w,"/terms"),className:"text-indigo-400 hover:underline",children:N("terms")}),k("agreeTermsAfter")]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("button",{type:"button",onClick:()=>A(e=>!e),className:"flex items-center gap-2 text-sm text-gray-400 hover:text-gray-300",children:[Z?(0,i.jsx)(b.Z,{className:"h-4 w-4"}):(0,i.jsx)(g.Z,{className:"h-4 w-4"}),k("privacySummary")]}),Z&&(0,i.jsxs)("ul",{className:"mt-2 text-sm text-gray-500 list-disc list-inside space-y-1",children:[(0,i.jsx)("li",{children:k("privacy1")}),(0,i.jsx)("li",{children:k("privacy2")}),(0,i.jsx)("li",{children:k("privacy3")}),(0,i.jsx)("li",{children:k("privacy4")})]})]}),(0,i.jsxs)("label",{className:"flex items-start gap-3 cursor-pointer",children:[(0,i.jsx)(d.X,{checked:z,onCheckedChange:e=>M(!!e)}),(0,i.jsx)("span",{className:"text-gray-300 text-sm",children:k("agreeSeller")})]})]})]}),(0,i.jsxs)("div",{className:"flex flex-wrap gap-4 justify-between pt-4",children:[(0,i.jsx)(c.z,{variant:"outline",onClick:()=>l.push("/".concat(w,"/sell/step4")),className:"border-white/10 text-gray-300 hover:bg-white/5 h-12 px-6 text-base",children:k("backToEdit")}),(0,i.jsxs)(c.z,{onClick:H,disabled:!O||U,className:"bg-indigo-600 hover:bg-indigo-500 disabled:opacity-50 h-12 px-8 text-base font-medium shadow-lg shadow-indigo-500/20",children:[U?(0,i.jsx)(v.Z,{className:"h-5 w-5 animate-spin mr-2"}):(0,i.jsx)(y.Z,{className:"h-5 w-5 mr-2"}),U?k("publishing"):k("publishListing")]})]})]})]}):(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 py-12 min-h-[70vh]",children:[(0,i.jsx)("p",{className:"text-gray-400",children:k("missingData")}),(0,i.jsx)(c.z,{variant:"outline",onClick:()=>l.push("/".concat(w,"/sell/step1")),className:"border-gray-600 text-gray-300",children:k("startOver")})]})}},85754:function(e,t,r){"use strict";r.d(t,{z:function(){return l}});var i=r(57437),n=r(2265),s=r(67256),a=r(1657);let l=n.forwardRef((e,t)=>{let{className:r,variant:n="default",size:l="default",asChild:o=!1,...c}=e,d=o?s.g7:"button";return(0,i.jsx)(d,{className:(0,a.cn)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{default:"bg-[#5B7FFF] text-white hover:bg-[#4a6fff]",destructive:"bg-red-600 text-white hover:bg-red-700",outline:"border border-slate-300 dark:border-[#2a2d3a] bg-transparent hover:bg-slate-100 dark:hover:bg-[#2a2d3a] text-slate-900 dark:text-white",secondary:"bg-slate-100 dark:bg-[#2a2d3a] text-slate-900 dark:text-white hover:bg-slate-200 dark:hover:bg-[#3a3d4a]",ghost:"hover:bg-slate-100 dark:hover:bg-[#2a2d3a] text-slate-900 dark:text-white",link:"text-[#5B7FFF] underline-offset-4 hover:underline"}[n],{default:"h-10 sm:h-10 px-4 py-2 min-h-[48px] sm:min-h-[40px]",sm:"h-9 sm:h-9 rounded-md px-3 min-h-[48px] sm:min-h-[36px]",lg:"h-11 sm:h-11 rounded-md px-8 min-h-[48px] sm:min-h-[44px]",icon:"h-10 w-10 sm:h-10 sm:w-10 min-h-[48px] min-w-[48px] sm:min-h-[40px] sm:min-w-[40px]"}[l],r),ref:t,...c})});l.displayName="Button"},54900:function(e,t,r){"use strict";r.d(t,{X:function(){return o}});var i=r(57437),n=r(2265),s=r(66062),a=r(1657),l=r(62442);let o=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)(s.fC,{ref:t,className:(0,a.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-[#2a2d3a] bg-[#0f1117] ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#5B7FFF] focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-[#5B7FFF] data-[state=checked]:text-white data-[state=checked]:border-[#5B7FFF]",r),...n,children:(0,i.jsx)(s.z$,{className:(0,a.cn)("flex items-center justify-center text-current"),children:(0,i.jsx)(l.Z,{className:"h-4 w-4"})})})});o.displayName=s.fC.displayName},6678:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return l},useAuthContext:function(){return o}});var i=r(57437),n=r(2265),s=r(45922);let a=(0,n.createContext)(null);function l(e){let{children:t}=e,[r,l]=(0,n.useState)(null),[o,c]=(0,n.useState)(null),[d,u]=(0,n.useState)(null),[h,m]=(0,n.useState)(!0),p=(0,n.useCallback)(async e=>{var t;let{data:r,error:i}=await s.supabase.from("users").select("role").eq("id",e).maybeSingle();return i||!r?null:null!==(t=r.role)&&void 0!==t?t:null},[]),f=(0,n.useCallback)(async()=>{try{let{data:{session:e},error:t}=await s.supabase.auth.getSession();if(t||!e){c(null),l(null),u(null);return}c(e),l(e.user),m(!1);try{let t=await p(e.user.id);u(t)}catch(e){u(null)}}catch(e){c(null),l(null),u(null)}finally{m(!1)}},[p]);(0,n.useEffect)(()=>{f();let{data:{subscription:e}}=s.supabase.auth.onAuthStateChange(async(e,t)=>{if("SIGNED_OUT"===e||!t){c(null),l(null),u(null),m(!1);return}c(t),l(t.user);try{let e=await p(t.user.id);u(e)}finally{m(!1)}}),t=setTimeout(()=>{m(e=>!e&&e)},8e3);return()=>{clearTimeout(t),e.unsubscribe()}},[f,p]);let x=(0,n.useCallback)(async()=>{m(!0),await s.supabase.auth.signOut(),c(null),l(null),u(null),m(!1)},[]),b=(0,n.useMemo)(()=>({user:r,session:o,role:d,isAdmin:"admin"===d,loading:h,signOut:x}),[r,o,d,h,x]);return(0,i.jsx)(a.Provider,{value:b,children:t})}function o(){let e=(0,n.useContext)(a);if(!e)throw Error("useAuthContext must be used within an AuthProvider");return e}},65864:function(e,t,r){"use strict";r.d(t,{E:function(){return d},e:function(){return u}});var i=r(57437),n=r(2265);let s="sell_wizard_draft",a={make:"",model:"",year:"",price:"",mileage:"",transmission:"",fuel_type:"",condition:"",body_type:"",color:"",previous_owners:"",accident_history:"",features:[]},l={phone:"",whatsapp:"",whatsappSameAsPhone:!0,preferredContact:"",bestTimeToCall:[],description:""},o={location:null,media:[],uploadedMediaUrls:[],carDetails:null,contact:null,editListingId:null,publishedListingId:null},c=(0,n.createContext)(null);function d(e){let{children:t}=e,[r,d]=(0,n.useState)(()=>({...o,...function(){try{var e,t,r,i,n;let a=localStorage.getItem(s);if(!a)return{};let l=JSON.parse(a);return{location:null!==(e=l.location)&&void 0!==e?e:null,media:[],uploadedMediaUrls:[],carDetails:null!==(t=l.carDetails)&&void 0!==t?t:null,contact:null!==(r=l.contact)&&void 0!==r?r:null,editListingId:null!==(i=l.editListingId)&&void 0!==i?i:null,publishedListingId:null!==(n=l.publishedListingId)&&void 0!==n?n:null}}catch(e){return{}}}()}));(0,n.useEffect)(()=>{!function(e){try{let t={location:e.location,media:[],uploadedMediaUrls:[],carDetails:e.carDetails,contact:e.contact,editListingId:e.editListingId,publishedListingId:e.publishedListingId};localStorage.setItem(s,JSON.stringify(t))}catch(e){console.warn("SellWizard persist failed:",e)}}(r)},[r]);let u=(0,n.useCallback)(e=>{d(t=>({...t,location:e}))},[]),h=(0,n.useCallback)(e=>{d(t=>({...t,media:e,uploadedMediaUrls:[]}))},[]),m=(0,n.useCallback)(e=>{d(t=>({...t,uploadedMediaUrls:e}))},[]),p=(0,n.useCallback)(e=>{let t=["video/mp4","video/quicktime","video/x-msvideo"],r=["image/jpeg","image/jpg","image/png","image/webp"];d(i=>{let n=[...i.media],s=n.length;for(let i of e){var a,l,o;if(n.length>=10)break;let e=t.includes(i.type)||/\.(mp4|mov|avi)$/i.test(i.name),c=r.includes(i.type)||/\.(jpe?g|png|webp)$/i.test(i.name);if(!e&&!c)continue;let d=URL.createObjectURL(i);n.push({id:null!==(o=null===(a=(l=crypto).randomUUID)||void 0===a?void 0:a.call(l))&&void 0!==o?o:"m-".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,9)),file:i,previewUrl:d,isVideo:e,isCover:0===n.length,order:s++})}let c=n.some(e=>e.isCover);return n.length&&!c&&(n[0].isCover=!0),{...i,media:n,uploadedMediaUrls:[]}})},[]),f=(0,n.useCallback)(e=>{d(t=>{var r;let i=t.media.filter(t=>t.id!==e);return(null===(r=t.media.find(t=>t.id===e))||void 0===r?void 0:r.isCover)&&i.length&&(i[0].isCover=!0),{...t,media:i,uploadedMediaUrls:[]}})},[]),x=(0,n.useCallback)(e=>{d(t=>({...t,media:t.media.map(t=>({...t,isCover:t.id===e})),uploadedMediaUrls:[]}))},[]),b=(0,n.useCallback)((e,t)=>{d(r=>{let i=[...r.media],[n]=i.splice(e,1);return n?(i.splice(t,0,n),{...r,media:i.map((e,t)=>({...e,order:t})),uploadedMediaUrls:[]}):r})},[]),g=(0,n.useCallback)(e=>{d(t=>({...t,carDetails:null===e?null:{...a,...t.carDetails,...e}}))},[]),v=(0,n.useCallback)(e=>{d(t=>({...t,contact:null===e?null:{...l,...t.contact,...e}}))},[]),y=(0,n.useCallback)(e=>{d(t=>({...t,editListingId:e}))},[]),j=(0,n.useCallback)(e=>{d(t=>({...t,publishedListingId:e}))},[]),w=(0,n.useCallback)(()=>{d({...o}),localStorage.removeItem(s)},[]),k=(0,n.useCallback)(e=>{d(t=>{var r,i;return{...t,location:e.location?{city:null!==(r=e.location.city)&&void 0!==r?r:"",neighborhood:null!==(i=e.location.neighborhood)&&void 0!==i?i:""}:t.location,carDetails:e.carDetails?{...a,...e.carDetails}:t.carDetails,contact:e.contact?{...l,...e.contact}:t.contact}})},[]),N=(0,n.useMemo)(()=>({...r,setLocation:u,setMedia:h,setUploadedMediaUrls:m,addMedia:p,removeMedia:f,setCover:x,reorderMedia:b,setCarDetails:g,setContact:v,setEditListingId:y,setPublishedListingId:j,clearDraft:w,loadForEdit:k}),[r,u,h,m,p,f,x,b,g,v,y,j,w,k]);return(0,i.jsx)(c.Provider,{value:N,children:t})}function u(){let e=(0,n.useContext)(c);if(!e)throw Error("useSellWizard must be used within SellWizardProvider");return e}},25703:function(e,t,r){"use strict";r.r(t),r.d(t,{ToastProvider:function(){return l},useToast:function(){return o}});var i=r(57437),n=r(2265),s=r(1657);let a=n.createContext({toast:()=>{}});function l(e){let{children:t}=e,[r,l]=n.useState([]),o=n.useCallback(e=>{var t;let r=Math.random().toString(36).substring(7);l(t=>[...t,{...e,id:r}]),setTimeout(()=>{l(e=>e.filter(e=>e.id!==r))},null!==(t=e.duration)&&void 0!==t?t:5e3)},[]);return(0,i.jsxs)(a.Provider,{value:{toast:o},children:[t,(0,i.jsx)("div",{className:"fixed bottom-0 right-0 z-[1200] flex w-full flex-col-reverse gap-2 p-4 sm:flex-col md:max-w-[420px]",children:r.map(e=>(0,i.jsxs)("div",{className:(0,s.cn)("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md p-6 pr-8 shadow-lg transition-all","destructive"===e.variant?"border border-red-500/50 bg-red-950/30":"border border-[#2a2d3a] bg-[#1a1d29]"),children:[(0,i.jsxs)("div",{className:"grid gap-1",children:[e.title&&(0,i.jsx)("div",{className:(0,s.cn)("text-sm font-semibold","destructive"===e.variant?"text-red-200":"text-white"),children:e.title}),e.description&&(0,i.jsx)("div",{className:(0,s.cn)("text-sm","destructive"===e.variant?"text-red-300/90":"text-[#94a3b8]"),children:e.description})]}),(0,i.jsx)("button",{onClick:()=>l(t=>t.filter(t=>t.id!==e.id)),className:"absolute right-2 top-2 rounded-md p-1 text-[#94a3b8] opacity-0 transition-opacity hover:text-white focus:opacity-100 focus:outline-none group-hover:opacity-100",children:"\xd7"})]},e.id))})]})}function o(){return n.useContext(a)||{toast:e=>{"destructive"===e.variant&&console.error("Error:",e.description)}}}},45922:function(e,t,r){"use strict";r.d(t,{supabase:function(){return i}});let i=(0,r(33226).eI)("https://fehkzrrahgyesxzrwlme.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZlaGt6cnJhaGd5ZXN4enJ3bG1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkxNzcwNjEsImV4cCI6MjA4NDc1MzA2MX0.AI8QaX8nOP8UwcfmgbGN2EN4jmK94i98Kpd3ZtPDZRQ",{auth:{lock:(e,t,r)=>r()}})},1657:function(e,t,r){"use strict";r.d(t,{cb:function(){return d},cn:function(){return s},gQ:function(){return c},uf:function(){return l},wo:function(){return u},xG:function(){return a}});var i=r(57042),n=r(74769);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,i.W)(t))}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"USD";return new Intl.NumberFormat("en-US",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function l(e){return new Intl.NumberFormat("en-US").format(e)}function o(e){return e<=0||!isFinite(e)?0:Math.round(235.214583/e*10)/10}function c(e,t){let r=o(e),i=o(t);return"".concat(r," / ").concat(i," L/100km")}function d(e){return null!=e&&"string"==typeof e&&/\.(mp4|mov|avi)(\?|$)/i.test(e)}function u(e,t){var r;if(null==e||"string"!=typeof e||!e)return"";if(e.startsWith("http://")||e.startsWith("https://"))return e;let i=(null!==(r=null!=t?t:"http://localhost:8000")&&void 0!==r?r:"").replace(/\/$/,"");return i?i+(e.startsWith("/")?e:"/"+e):e}},66062:function(e,t,r){"use strict";r.d(t,{fC:function(){return j},z$:function(){return k}});var i=r(2265),n=r(42210),s=r(56989),a=r(85744),l=r(73763),o=r(85184),c=r(94977),d=r(85606),u=r(31033),h=r(57437),m="Checkbox",[p,f]=(0,s.b)(m),[x,b]=p(m);function g(e){let{__scopeCheckbox:t,checked:r,children:n,defaultChecked:s,disabled:a,form:o,name:c,onCheckedChange:d,required:u,value:p="on",internal_do_not_use_render:f}=e,[b,g]=(0,l.T)({prop:r,defaultProp:s??!1,onChange:d,caller:m}),[v,y]=i.useState(null),[j,w]=i.useState(null),k=i.useRef(!1),N=!v||!!o||!!v.closest("form"),C={checked:b,disabled:a,setChecked:g,control:v,setControl:y,name:c,form:o,value:p,hasConsumerStoppedPropagationRef:k,required:u,defaultChecked:!S(s)&&s,isFormControl:N,bubbleInput:j,setBubbleInput:w};return(0,h.jsx)(x,{scope:t,...C,children:"function"==typeof f?f(C):n})}var v="CheckboxTrigger",y=i.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:r,...s},l)=>{let{control:o,value:c,disabled:d,checked:m,required:p,setControl:f,setChecked:x,hasConsumerStoppedPropagationRef:g,isFormControl:y,bubbleInput:j}=b(v,e),w=(0,n.e)(l,f),k=i.useRef(m);return i.useEffect(()=>{let e=o?.form;if(e){let t=()=>x(k.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[o,x]),(0,h.jsx)(u.WV.button,{type:"button",role:"checkbox","aria-checked":S(m)?"mixed":m,"aria-required":p,"data-state":I(m),"data-disabled":d?"":void 0,disabled:d,value:c,...s,ref:w,onKeyDown:(0,a.Mj)(t,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,a.Mj)(r,e=>{x(e=>!!S(e)||!e),j&&y&&(g.current=e.isPropagationStopped(),g.current||e.stopPropagation())})})});y.displayName=v;var j=i.forwardRef((e,t)=>{let{__scopeCheckbox:r,name:i,checked:n,defaultChecked:s,required:a,disabled:l,value:o,onCheckedChange:c,form:d,...u}=e;return(0,h.jsx)(g,{__scopeCheckbox:r,checked:n,defaultChecked:s,disabled:l,required:a,onCheckedChange:c,name:i,form:d,value:o,internal_do_not_use_render:({isFormControl:e})=>(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(y,{...u,ref:t,__scopeCheckbox:r}),e&&(0,h.jsx)(C,{__scopeCheckbox:r})]})})});j.displayName=m;var w="CheckboxIndicator",k=i.forwardRef((e,t)=>{let{__scopeCheckbox:r,forceMount:i,...n}=e,s=b(w,r);return(0,h.jsx)(d.z,{present:i||S(s.checked)||!0===s.checked,children:(0,h.jsx)(u.WV.span,{"data-state":I(s.checked),"data-disabled":s.disabled?"":void 0,...n,ref:t,style:{pointerEvents:"none",...e.style}})})});k.displayName=w;var N="CheckboxBubbleInput",C=i.forwardRef(({__scopeCheckbox:e,...t},r)=>{let{control:s,hasConsumerStoppedPropagationRef:a,checked:l,defaultChecked:d,required:m,disabled:p,name:f,value:x,form:g,bubbleInput:v,setBubbleInput:y}=b(N,e),j=(0,n.e)(r,y),w=(0,o.D)(l),k=(0,c.t)(s);i.useEffect(()=>{if(!v)return;let e=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,t=!a.current;if(w!==l&&e){let r=new Event("click",{bubbles:t});v.indeterminate=S(l),e.call(v,!S(l)&&l),v.dispatchEvent(r)}},[v,w,l,a]);let C=i.useRef(!S(l)&&l);return(0,h.jsx)(u.WV.input,{type:"checkbox","aria-hidden":!0,defaultChecked:d??C.current,required:m,disabled:p,name:f,value:x,form:g,...t,tabIndex:-1,ref:j,style:{...t.style,...k,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function S(e){return"indeterminate"===e}function I(e){return S(e)?"indeterminate":e?"checked":"unchecked"}C.displayName=N},67256:function(e,t,r){"use strict";r.d(t,{g7:function(){return d}});var i,n=r(2265),s=r(42210),a=r(57437),l=Symbol.for("react.lazy"),o=(i||(i=r.t(n,2)))[" use ".trim().toString()];function c(e){var t;return null!=e&&"object"==typeof e&&"$$typeof"in e&&e.$$typeof===l&&"_payload"in e&&"object"==typeof(t=e._payload)&&null!==t&&"then"in t}var d=function(e){let t=function(e){let t=n.forwardRef((e,t)=>{let{children:r,...i}=e;if(c(r)&&"function"==typeof o&&(r=o(r._payload)),n.isValidElement(r)){var a;let e,l;let o=(a=r,(e=Object.getOwnPropertyDescriptor(a.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?a.ref:(e=Object.getOwnPropertyDescriptor(a,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?a.props.ref:a.props.ref||a.ref),c=function(e,t){let r={...t};for(let i in t){let n=e[i],s=t[i];/^on[A-Z]/.test(i)?n&&s?r[i]=(...e)=>{let t=s(...e);return n(...e),t}:n&&(r[i]=n):"style"===i?r[i]={...n,...s}:"className"===i&&(r[i]=[n,s].filter(Boolean).join(" "))}return{...e,...r}}(i,r.props);return r.type!==n.Fragment&&(c.ref=t?(0,s.F)(t,o):o),n.cloneElement(r,c)}return n.Children.count(r)>1?n.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),r=n.forwardRef((e,r)=>{let{children:i,...s}=e;c(i)&&"function"==typeof o&&(i=o(i._payload));let l=n.Children.toArray(i),d=l.find(h);if(d){let e=d.props.children,i=l.map(t=>t!==d?t:n.Children.count(e)>1?n.Children.only(null):n.isValidElement(e)?e.props.children:null);return(0,a.jsx)(t,{...s,ref:r,children:n.isValidElement(e)?n.cloneElement(e,void 0,i):null})}return(0,a.jsx)(t,{...s,ref:r,children:i})});return r.displayName=`${e}.Slot`,r}("Slot"),u=Symbol("radix.slottable");function h(e){return n.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===u}},85184:function(e,t,r){"use strict";r.d(t,{D:function(){return n}});var i=r(2265);function n(e){let t=i.useRef({value:e,previous:e});return i.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}},94977:function(e,t,r){"use strict";r.d(t,{t:function(){return s}});var i=r(2265),n=r(51030);function s(e){let[t,r]=i.useState(void 0);return(0,n.b)(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{let i,n;if(!Array.isArray(t)||!t.length)return;let s=t[0];if("borderBoxSize"in s){let e=s.borderBoxSize,t=Array.isArray(e)?e[0]:e;i=t.inlineSize,n=t.blockSize}else i=e.offsetWidth,n=e.offsetHeight;r({width:i,height:n})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}r(void 0)},[e]),t}}},function(e){e.O(0,[7895,116,263,6376,3226,1396,2971,4938,1744],function(){return e(e.s=79094)}),_N_E=e.O()}]);