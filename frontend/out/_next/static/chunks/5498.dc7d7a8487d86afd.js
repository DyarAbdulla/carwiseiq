"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5498],{35498:function(t,i,e){e.d(i,{activityHelpers:function(){return d},j:function(){return r}});var o=e(45922);let n="carwiseiq_activity_log";function r(t){try{let i=JSON.parse(localStorage.getItem(n)||"[]"),e=Array.isArray(i)?i:[];if(t)return e.filter(i=>!i.user_id||i.user_id===t);return e}catch(t){return[]}}let l=!1;async function a(t){var i,e,r,a;let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g={type:t,entity_id:(null===(i=d.entity_id)||void 0===i?void 0:i.toString())||null,metadata:d};try{let{data:{session:i}}=await o.supabase.auth.getSession(),d=null==i?void 0:null===(e=i.user)||void 0===e?void 0:e.id;if(!function(t){try{let i=JSON.parse(localStorage.getItem(n)||"[]"),e={...t,id:"local_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2)),created_at:new Date().toISOString()};i.unshift(e),localStorage.setItem(n,JSON.stringify(i.slice(0,200)))}catch(t){}}({...g,user_id:d}),l||!d)return;let{error:s}=await o.supabase.from("user_activity").insert({user_id:d,type:t,entity_id:g.entity_id,metadata:g.metadata});if(!s)return;("PGRST205"===s.code||(null===(r=s.message)||void 0===r?void 0:r.includes("Could not find the table"))||(null===(a=s.message)||void 0===a?void 0:a.includes("404")))&&(l=!0)}catch(t){}}let d={logPrediction:t=>{var i;return a("prediction",{entity_id:(null===(i=t.predictionId)||void 0===i?void 0:i.toString())||null,car_make:t.make,car_model:t.model,car_year:t.year,predicted_price:t.predictedPrice})},logCompare:(t,i)=>a("compare",{entity_id:t.join(","),comparison_count:i,compared_ids:t.map(t=>t.toString())}),logViewListing:(t,i)=>a("view_listing",{entity_id:t.toString(),listing_title:i}),logFavorite:(t,i)=>a("favorite",{entity_id:t.toString(),action:i?"added":"removed"}),logCreateListing:(t,i,e)=>a("create_listing",{entity_id:t.toString(),listing_title:i,listing_price:e}),logEditListing:(t,i)=>a("edit_listing",{entity_id:t.toString(),listing_title:i}),logMarkSold:(t,i)=>a("mark_sold",{entity_id:t.toString(),listing_title:i}),logPredictionCreated:t=>d.logPrediction(t),logPredictionSaved:t=>a("prediction",{entity_id:t.toString()}),logComparisonSaved:(t,i)=>d.logCompare(i,t),logComparisonViewed:t=>d.logCompare(t,t.length),logListingViewed:(t,i)=>d.logViewListing(t,i),logListingCreated:(t,i,e)=>d.logCreateListing(t,i,e),logListingEdited:(t,i)=>d.logEditListing(t,i),logListingSold:(t,i)=>d.logMarkSold(t,i),logListingAvailable:(t,i)=>a("edit_listing",{entity_id:t.toString(),listing_title:i,action:"marked_available"}),logFavoriteAdded:t=>d.logFavorite(t,!0),logFavoriteRemoved:t=>d.logFavorite(t,!1)}}}]);